# Detecting Android Malware with Convolutional Neural Networks and Hilbert Space Filling Curves 
In this repository, we host the artefacts for our approach

## System Requirements and Installation

Install Ubuntu, Install Anaconda for Python

## Download Dataset

We used the _az_ python script to download benign and malicious APK samples randomly from the AndroZoo dataset using the some shell commands.
### Malware download shell command:
az −n 12000 −d 2015−12−11: −s :1000000 − vt 20 : −m VirusShare −md sha256, pkg_name, apk_size, dex_size, dex_date, vt_detection, markets −t 40
### Benign apps download shell command:
az −n 12000 −d 2015−12−11: −s :1000000 − vt 0:0 −m play.google.com −md sha256, pkg_name, apk_size, dex_size, dex_date, vt_detection, markets −t 40

See this [GitHub page](https://github.com/ArtemKushnerov/az) for details on how to use the _az python script_

## Preprocessing Step

We extracted the files classes.dex from the APKS, then DEX data section files from the classes.dex files using _Preprocessing.ipynb_ python script by considering the offsets from the header section (first 112 bytes)

## Hilbert Image Generation Process

The code to generate the image datasets from the extracted DEX datasection files is found in the script _All codes.ipynb_

### Inputs are:
- A folder containing all the extracted DEX datasection files
- Path in which the resulting images will be stored

### Output:
- Images representing the DEX datasection files generated using our Hilbert mapping approach

### Image availability datasets
Due to the large size of the images dataset, we share it upon request

## To generate Obfuscated APKs, use _obfuscate_script.sh_ script 
This script is run inside Obfuscapk/src folder. See the [GitHub page](https://github.com/ClaudiuGeorgiu/Obfuscapk) for more details on how to use this tool

### Inputs are:
- A folder containing all the malicious and benign APK files
- Path in which the resulting obfuscated APKs will be stored

### Output:
- Malicious and benign APKs that have been obfuscated using six obfuscation techniques
  
## To train and test CNN moels, use _Models.ipynb_ script:
This script trains the pretrained CNN models (VGG16, ResNet50, InceptionV3, EfficientNetB0) using the training images, and evaluates its learning using the test dataset. The evaluation is repeated 10 times using the holdout technique. The training, validation and test APK names are provided in data_splits directory. To use this script, you need to extract the images for benign and malware applications using the **_create_datasplits.ipynb_** script.
