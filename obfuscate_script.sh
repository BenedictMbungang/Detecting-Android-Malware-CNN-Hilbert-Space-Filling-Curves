#!/bin/sh

# Author : MBUNGANG NGAIBE B.
# Copyright (c) destdester@gmail.com
# Script follows here:

COUNT=0
COUNT_ERR=0
for file in /media/ngaibe/EXTERNAL_USB/dataset/goodware/*; do
    #APK = $(basename "$file")
    COUNT=`expr $COUNT + 1`
    echo "obfuscating $(basename "$file"), APK No. "$COUNT""
    python3 -m obfuscapk.cli -o CallIndirection -o ClassRename -o ConstStringEncryption -o FieldRename -o MethodOverload -o MethodRename -o Rebuild -o NewAlignment -o NewSignature $file -w /media/ngaibe/EXTERNAL_USB/dataset/goodware_obfuscated/ 
    if [ $? -eq 0 ]; then
      echo "Command Executed Successfully"
    else
      echo "$(basename "$file")" >> error
      echo "Command Failed"
      COUNT_ERR=`expr $COUNT_ERR + 1`
    fi
    #echo "$(basename "$file")"
done
echo "end obfuscation, $COUNT_ERR failed apks out of $COUNT"
